import{r as u,c as V,b as n,w as z,d as S,e as o,g as r,h as W,u as P,m as B,F as b,k as x,f as F,n as I,t as i,j as D,i as k,v as $,l as U,W as j}from"./app-DqWAvktM.js";import G from"./Admin-DwthQgva.js";import"./Header-X6uiH6jU.js";import"./index-DXZpKVQg.js";import"./Sidebar-Db8HPz_V.js";const H={class:"container mx-auto p-6"},K={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},L=["onDrop"],O={class:"text-xl font-semibold mb-3"},q={key:0},J=["onDragstart","onClick"],Q={class:"font-semibold"},R={class:"text-gray-700 text-sm"},X={class:"text-gray-500 text-xs"},Y={key:0,class:"text-blue-700 text-xs"},Z={key:1,class:"text-gray-500"},ee={key:0,class:"fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50"},oe={class:"bg-white p-6 rounded-lg shadow-md w-[90%]"},te={key:0},se=["href"],ne={key:1,class:"text-gray-500"},ae=["value"],re={key:0,class:"fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg z-50 transition-all duration-300"},pe={__name:"Works",props:{pendingWorks:Array,inProgressWorks:Array,waitingConfirmationWorks:Array,completedWorks:Array,admins:Array},setup(g){const p=g,y=u(""),h=u(!1),A=l=>{y.value=l,h.value=!0,setTimeout(()=>{h.value=!1,y.value=""},3e3)},d=u(null),m=u(null),v=u(null),_=u(!1),f=u({pendiente:[...p.pendingWorks],en_progreso:[...p.inProgressWorks],esperando_confirmacion:[...p.waitingConfirmationWorks],finalizado:[...p.completedWorks]}),C=l=>{d.value=l,m.value=l.assigned_to||null,v.value=l.due_date||null,_.value=!0},N=()=>{d.value&&j.put(route("admin.works.reassign",d.value.id),{assigned_to:m.value,due_date:v.value},{preserveState:!0,onSuccess:()=>{T(),A("✅ Trabajo asignado correctamente")},onError:()=>{A("❌ Hubo un error")}})},T=()=>{_.value=!1,d.value=null},w=(l,e)=>{if(!e||!e.id){console.error("Error: Trabajo no definido en dragStart()",e);return}l.dataTransfer.setData("workId",e.id)},E=(l,e)=>{l.preventDefault();const t=l.dataTransfer.getData("workId");let s=null;Object.keys(f.value).forEach(a=>{const c=f.value[a].findIndex(M=>M.id==t);c!==-1&&(s=f.value[a].splice(c,1)[0])}),s&&s.estado!==e&&(s.estado=e,f.value[e].push(s),j.put(route("admin.works.updateStatus",s.id),{estado:e},{preserveState:!0}))};return(l,e)=>(n(),V(G,null,{default:z(()=>[S(P(B),{title:"Gestión de Trabajos"}),o("div",H,[e[14]||(e[14]=o("h1",{class:"text-3xl font-bold mb-6"},"🗂 Tablero Kanban de Trabajos",-1)),o("div",K,[(n(!0),r(b,null,x({pendiente:g.pendingWorks,en_progreso:g.inProgressWorks,esperando_confirmacion:g.waitingConfirmationWorks,finalizado:g.completedWorks},(t,s)=>(n(),r("div",{key:s,class:I(["p-4 rounded-lg shadow-md min-h-[300px]",{"bg-amber-200":s==="pendiente","bg-blue-200":s==="en_progreso","bg-orange-200":s==="esperando_confirmacion","bg-emerald-200":s==="finalizado"}]),onDragstart:e[0]||(e[0]=a=>w(a,l.work)),onDragover:e[1]||(e[1]=F(()=>{},["prevent"])),onDrop:a=>E(a,s)},[o("h2",O,i(s==="pendiente"?"📌 Pendientes":s==="en_progreso"?"🛠️ En Progreso":s==="esperando_confirmacion"?"⏳ Esperando Confirmación":"✅ Finalizados"),1),t.length?(n(),r("div",q,[(n(!0),r(b,null,x(t,a=>(n(),r("div",{key:a.id,draggable:"true",class:"p-3 rounded shadow mb-2 bg-gray-200 cursor-pointer",onDragstart:c=>w(c,a),onClick:c=>C(a)},[o("p",Q,i(a.titulo),1),o("p",R,"👤 "+i(a.client.user.name),1),o("p",X,"🏢 "+i(a.client.empresa||"No especificada"),1),a.assignedAdmin?(n(),r("p",Y,"👷 Asignado a: "+i(a.assignedAdmin.name),1)):W("",!0)],40,J))),128))])):(n(),r("p",Z,"No hay trabajos en esta categoría."))],42,L))),128))]),_.value?(n(),r("div",ee,[o("div",oe,[e[9]||(e[9]=o("h2",{class:"text-2xl font-bold mb-3"},"Detalles del Trabajo",-1)),o("p",null,[e[4]||(e[4]=o("strong",null,"Título:",-1)),k(" "+i(d.value.titulo),1)]),o("p",null,[e[5]||(e[5]=o("strong",null,"Descripción:",-1)),k(" "+i(d.value.descripcion),1)]),o("p",null,[e[6]||(e[6]=o("strong",null,"Cliente:",-1)),k(" "+i(d.value.client.user.name),1)]),o("p",null,[e[7]||(e[7]=o("strong",null,"Empresa:",-1)),k(" "+i(d.value.client.empresa||"No especificada"),1)]),e[10]||(e[10]=o("h3",{class:"mt-4 font-semibold"},"📂 Archivos Adjuntos:",-1)),d.value.archivos&&d.value.archivos.length?(n(),r("ul",te,[(n(!0),r(b,null,x(d.value.archivos,t=>(n(),r("li",{key:t},[o("a",{href:`/storage/${t}`,target:"_blank",class:"text-blue-500 hover:underline"},i(t),9,se)]))),128))])):(n(),r("p",ne,"No hay archivos adjuntos.")),e[11]||(e[11]=o("h3",{class:"mt-6 text-xl font-semibold"},"🔧 Asignar Trabajo",-1)),e[12]||(e[12]=o("label",{class:"block mt-4"},"📅 Fecha de Vencimiento",-1)),D(o("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),class:"border p-2 rounded w-full"},null,512),[[$,v.value]]),e[13]||(e[13]=o("label",{class:"block mt-4"},"👷 Asignar a:",-1)),D(o("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>m.value=t),class:"border p-2 rounded w-full"},[e[8]||(e[8]=o("option",{value:null},"Sin Asignar",-1)),(n(!0),r(b,null,x(p.admins,t=>(n(),r("option",{key:t.id,value:t.id},i(t.name),9,ae))),128))],512),[[U,m.value]]),o("div",{class:"mt-6 flex justify-between"},[o("button",{onClick:N,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-700"}," Asignar "),o("button",{onClick:T,class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-700"}," Cerrar ")])])])):W("",!0)]),h.value?(n(),r("div",re,i(y.value),1)):W("",!0)]),_:1}))}};export{pe as default};
